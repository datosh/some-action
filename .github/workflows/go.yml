name: go

on:
  pull_request:

jobs:
  go:
    runs-on: ubuntu-latest
    permissions:
      checks: write         # for EnricoMi/publish-unit-test-result-action@v1
      pull-requests: write  # for EnricoMi/publish-unit-test-result-action@v1
    steps:
    - name: Check out repository
      uses: actions/checkout@v3
    - name: Setup Go
      uses: actions/setup-go@v3
      with:
        go-version: '1.18'
    - name: Install go-junit-report
      run: go install github.com/jstemmer/go-junit-report@v1.0.0

    # This step has exit_code=1, if any tests fail
    - name: Run Unit Tests
      run: go test -v 2>&1 ./... | go-junit-report -set-exit-code > report.xml
    - name: Publish Test Report
      uses: mikepenz/action-junit-report@v3
      if: always() # always run even if the previous step fails
      with:
        report_paths: report.xml
