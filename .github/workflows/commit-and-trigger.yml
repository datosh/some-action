name: commit-and-trigger

on:
  workflow_dispatch:

permissions: {}

env:
  GO_VERSION: "1.19.2"
  SYFT_VERSION: "0.58.0"
  GRYPE_VERSION: "0.50.2"
  IMAGE_REF: "ghcr.io/${{ github.repository }}/calculator"

jobs:
  commit-and-trigger:
    runs-on: ubuntu-22.04
    steps:
      - name: Check out repository
        uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0
        with:
          token: ${{ secrets.COMMIT_AND_TRIGGER_PAT }}
          ref: ${{ github.head_ref }}
      - name: Setup Go
        uses: actions/setup-go@c4a742cab115ed795e34d4513e2cf7d472deb55f # tag=v3.3.1
        with:
          go-version: ${{ env.GO_VERSION }}
      - name: go mod tidy
        run: |
          go mod tidy
      - name: Commit changes
        id: commit
        uses: EndBug/add-and-commit@61a88be553afe4206585b31aa72387c64295d08b # tag=v9.1.1
      - name: Summary
        run: |
          echo Did commit? ${{ steps.commit.outputs.committed }}
          echo Commit SHA: ${{ steps.commit.outputs.commit_sha }}
          echo Did push? ${{ steps.commit.outputs.pushed }}
